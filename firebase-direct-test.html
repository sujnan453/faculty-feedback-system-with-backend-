<!DOCTYPE html>
<html>

<head>
    <title>Direct Firebase Test</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #00ff00;
        }

        .log {
            margin: 5px 0;
            padding: 5px;
        }

        .error {
            color: #ff0000;
        }

        .success {
            color: #00ff00;
        }

        .info {
            color: #00aaff;
        }
    </style>
</head>

<body>
    <h1>üî• Direct Firebase Connection Test</h1>
    <div id="log"></div>

    <script type="module">
        function log(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            document.getElementById('log').appendChild(div);
            console.log(msg);
        }

        log('Starting Firebase test...', 'info');

        try {
            // Step 1: Import Firebase
            log('Step 1: Importing Firebase modules...', 'info');
            const { initializeApp } = await import("https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js");
            log('‚úÖ Firebase app module loaded', 'success');

            const { getDatabase, ref, set, get } = await import("https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js");
            log('‚úÖ Firebase database module loaded', 'success');

            // Step 2: Initialize Firebase
            log('Step 2: Initializing Firebase...', 'info');
            const firebaseConfig = {
                apiKey: "AIzaSyA6Nr81548vWJiEPdltuIFtNyEpwc0RjcE",
                authDomain: "faculty-feedback-system-f4a83.firebaseapp.com",
                databaseURL: "https://faculty-feedback-system-f4a83-default-rtdb.firebaseio.com",
                projectId: "faculty-feedback-system-f4a83",
                storageBucket: "faculty-feedback-system-f4a83.firebasestorage.app",
                messagingSenderId: "784604808754",
                appId: "1:784604808754:web:6035f842b92ae5bdda5e2b"
            };

            const app = initializeApp(firebaseConfig);
            log('‚úÖ Firebase app initialized', 'success');

            const database = getDatabase(app);
            log('‚úÖ Database instance created', 'success');
            log(`Database URL: ${firebaseConfig.databaseURL}`, 'info');

            // Step 3: Test Write
            log('Step 3: Testing database write...', 'info');
            const testRef = ref(database, 'connection_test/test_' + Date.now());
            await set(testRef, {
                message: 'Connection test successful',
                timestamp: new Date().toISOString()
            });
            log('‚úÖ Write successful!', 'success');

            // Step 4: Test Read
            log('Step 4: Testing database read...', 'info');
            const snapshot = await get(testRef);
            if (snapshot.exists()) {
                log('‚úÖ Read successful!', 'success');
                log(`Data: ${JSON.stringify(snapshot.val())}`, 'info');
            } else {
                log('‚ö†Ô∏è No data found', 'error');
            }

            // Step 5: Test user creation
            log('Step 5: Testing user creation...', 'info');
            const userId = 'test_user_' + Date.now();
            const userRef = ref(database, 'users/' + userId);
            await set(userRef, {
                id: userId,
                name: 'Test User',
                email: 'test@example.com',
                role: 'student',
                createdAt: new Date().toISOString()
            });
            log('‚úÖ User created successfully!', 'success');

            // Step 6: Test user read
            log('Step 6: Testing user read...', 'info');
            const usersRef = ref(database, 'users');
            const usersSnapshot = await get(usersRef);
            if (usersSnapshot.exists()) {
                const users = usersSnapshot.val();
                const userCount = Object.keys(users).length;
                log(`‚úÖ Found ${userCount} users in database`, 'success');
            } else {
                log('‚ö†Ô∏è No users found', 'info');
            }

            log('', 'info');
            log('üéâ ALL TESTS PASSED!', 'success');
            log('Firebase is working correctly!', 'success');
            log('', 'info');
            log('Next steps:', 'info');
            log('1. Check Firebase Console: https://console.firebase.google.com/', 'info');
            log('2. Go to Realtime Database ‚Üí Data', 'info');
            log('3. You should see connection_test and users nodes', 'info');

        } catch (error) {
            log('', 'info');
            log('‚ùå TEST FAILED!', 'error');
            log(`Error: ${error.message}`, 'error');
            log(`Stack: ${error.stack}`, 'error');
            log('', 'info');
            log('Possible issues:', 'info');
            log('1. Check your internet connection', 'info');
            log('2. Check Firebase Console ‚Üí Realtime Database ‚Üí Rules', 'info');
            log('3. Make sure rules allow read/write', 'info');
            log('4. Check browser console for CORS errors', 'info');
        }
    </script>
</body>

</html>